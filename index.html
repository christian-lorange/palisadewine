 <!Doctype html>
<html>
<head>
  <title>Palisade Valley Wine</title>

  <meta name="viewport" content="width=device-width, user-scalable=no">

  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-red.min.css" />
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

  <script src="js/main.js"></script>
  <script src="js/admob.js"></script>

  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyBikdMuIl6ZeY8jyWWZ3c31JZMynGUWSqQ">//AIzaSyBikdMuIl6ZeY8jyWWZ3c31JZMynGUWSqQ</script> 


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.1.0.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>


<link rel="stylesheet" href="css/style.css" />
<!-- <link rel="stylesheet" href="css/main.css"> -->


<!-- Load locations -->
<script type="text/javascript">
setTimeout(function(){
 $("#venues").load( "https://raw.githack.com/christian-lorange/palisadewine/master/venues.html" );
 console.log('valdate')
  },200);
</script>
<!-- End of loading locations -->

<!-- Determine distance to wineries -->
<script type = "text/javascript" >
    function calcCrow(lat1, lon1, lat2, lon2) {
        var R = 3950; // miles
        var dLat = toRad(lat2 - lat1);
        var dLon = toRad(lon2 - lon1);
        var lat1 = toRad(lat1);
        var lat2 = toRad(lat2);

        var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        var d = R * c;
        return d;
    }

// Converts numeric degrees to radians
function toRad(Value) {
    return Value * Math.PI / 180;
}


function navfunction() {

	if (window.location.hash === "#routeload") {
		route();
        adcount();
        }

     if (window.location.hash === "#tourload") {
		tour();
        adcount();
        }

    var locs = [
        ["38.82634","-107.60381"],["39.07861","-108.41027"],["38.88589","-107.58253"],["39.07221","-108.40469"],["39.07505","-108.39373"],["39.115529","-108.325794"],["38.60797","-108.03621"],["39.105627","-108.355456"],["39.04227","-108.45359"],["39.107404","-108.389369"],["39.117231","-108.362088"],["39.091901","-108.430842"],["39.09035","-108.3667"],["39.045728","-108.447431"],["39.104194","-108.389553"],["39.105832","-108.365821"],["39.046375","-108.436188"],["38.60738","-108.00163"],["39.106845","-108.365892"],["39.03675","-108.4749"],["39.10468","-108.38576"],["39.0846623","-108.3857671"],["39.06603","-108.56488"],["39.116621","-108.36067"],["38.899693","-107.577303"],["39.097046","-108.349879"],["39.116621","-108.36067"],["39.04591","-108.44237"],["39.090821","-108.662153"],["39.111978","-108.355815"],["39.03685","-108.45828"],["39.118056","-108.364689"]
    ]
    var hourstext = ['By Appointment','May-Sept<br>Fri: 12-5<br>Sat: 11-5<br>Sun: 12-4<br>Mon-Thur: By Appointment','Memorial Day - Halloween<br>10-6','10am-5:45pm','Winter: M-F 9 - 4<br>Sat 11 - 5<br>Summer: M-F 9 - 5<br>Sat/Sun 10 - 5','10am - 5pm','By Appointment','Late April-October<br>Sun - Thurs <br>11 - 6<br>Fri/Sat 11 -7<br>October to late April<br> Sun - Fri Noon- 5<br>Sat 11 -5']

    navigator.geolocation.getCurrentPosition(showPosition);

    function showPosition(position) {
        var lat2 = position.coords.latitude;
        var lon2 = position.coords.longitude;

        var i;
        for (i = 0; i < locs.length; i++) {
            // console.log(calcCrow(locs[i][0],locs[i][1],lat2,lon2).toFixed(1));

            var temp = calcCrow(locs[i][0], locs[i][1], lat2, lon2).toFixed(1)

            document.getElementsByClassName("distancetext")[i].innerHTML = temp + ' miles';

            // document.getElementsByClassName("hours")[i].innerHTML = hourstext[i];
        }
    }
}


</script>
<!-- End of winery distance calculations -->

<!-- Start of routing script -->
<script type = "text/javascript" >
var map;
var directionsDisplay;
var directionsService;
var polylinePath;

var nodes = [];
var prevNodes = [];
var markers = [];
var durations = [];

// Initialize google maps
function initializeMap() {
    var geocoder = new google.maps.Geocoder();

    document.getElementById('submit').addEventListener('click', function() {
        geocodeAddress(geocoder, map);
    });

    // Map options
    var opts = {
        center: new google.maps.LatLng(39.100077, -108.356109),
        zoom: 11,
        streetViewControl: false,
        mapTypeControl: false,
        styles: [{
                "featureType": "administrative",
                "elementType": "all",
                "stylers": [{
                        "hue": "#ffcc00"
                    },
                    {
                        "saturation": 5
                    },
                    {
                        "lightness": -57
                    },
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "administrative.province",
                "elementType": "all",
                "stylers": [{
                        "hue": "#ff0000"
                    },
                    {
                        "lightness": 100
                    },
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "administrative.locality",
                "elementType": "all",
                "stylers": [{
                    "visibility": "off"
                }]
            },
            {
                "featureType": "administrative.locality",
                "elementType": "labels",
                "stylers": [{
                        "hue": "#ffffff"
                    },
                    {
                        "lightness": 100
                    },
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "administrative.neighborhood",
                "elementType": "all",
                "stylers": [{
                        "hue": "#ff0000"
                    },
                    {
                        "lightness": 100
                    },
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "administrative.land_parcel",
                "elementType": "all",
                "stylers": [{
                        "hue": "#ff0000"
                    },
                    {
                        "lightness": 100
                    },
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "landscape",
                "elementType": "geometry",
                "stylers": [{
                        "hue": "#b7caaa"
                    },
                    {
                        "saturation": -14
                    },
                    {
                        "lightness": -18
                    },
                    {
                        "visibility": "on"
                    }
                ]
            },
            {
                "featureType": "landscape.man_made",
                "elementType": "all",
                "stylers": [{
                        "hue": "#66ff00"
                    },
                    {
                        "saturation": -6
                    },
                    {
                        "lightness": -9
                    },
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "poi",
                "elementType": "geometry",
                "stylers": [{
                        "hue": "#c17118"
                    },
                    {
                        "saturation": 61
                    },
                    {
                        "lightness": -45
                    },
                    {
                        "visibility": "on"
                    }
                ]
            },
            {
                "featureType": "poi.business",
                "elementType": "all",
                "stylers": [{
                    "visibility": "off"
                }]
            },
            {
                "featureType": "poi.government",
                "elementType": "all",
                "stylers": [{
                    "visibility": "off"
                }]
            },
            {
                "featureType": "poi.medical",
                "elementType": "all",
                "stylers": [{
                    "visibility": "off"
                }]
            },
            {
                "featureType": "poi.medical",
                "elementType": "geometry",
                "stylers": [{
                        "hue": "#cba923"
                    },
                    {
                        "saturation": 50
                    },
                    {
                        "lightness": -46
                    },
                    {
                        "visibility": "on"
                    }
                ]
            },
            {
                "featureType": "poi.park",
                "elementType": "all",
                "stylers": [{
                        "hue": "#6cff00"
                    },
                    {
                        "saturation": -46
                    },
                    {
                        "lightness": -28
                    },
                    {
                        "visibility": "on"
                    }
                ]
            },
            {
                "featureType": "poi.place_of_worship",
                "elementType": "all",
                "stylers": [{
                    "visibility": "off"
                }]
            },
            {
                "featureType": "poi.school",
                "elementType": "all",
                "stylers": [{
                    "visibility": "off"
                }]
            },
            {
                "featureType": "poi.sports_complex",
                "elementType": "all",
                "stylers": [{
                    "visibility": "off"
                }]
            },
            {
                "featureType": "road",
                "elementType": "geometry",
                "stylers": [{
                        "hue": "#8d9b83"
                    },
                    {
                        "saturation": -89
                    },
                    {
                        "lightness": -12
                    },
                    {
                        "visibility": "on"
                    }
                ]
            },
            {
                "featureType": "road.highway",
                "elementType": "geometry",
                "stylers": [{
                        "hue": "#d4dad0"
                    },
                    {
                        "saturation": -88
                    },
                    {
                        "lightness": 54
                    },
                    {
                        "visibility": "simplified"
                    }
                ]
            },
            {
                "featureType": "road.arterial",
                "elementType": "geometry",
                "stylers": [{
                        "hue": "#77ff00"
                    },
                    {
                        "saturation": -89
                    },
                    {
                        "lightness": -3
                    },
                    {
                        "visibility": "simplified"
                    }
                ]
            },
            {
                "featureType": "road.local",
                "elementType": "geometry",
                "stylers": [{
                        "hue": "#bdc5b6"
                    },
                    {
                        "saturation": -89
                    },
                    {
                        "lightness": -26
                    },
                    {
                        "visibility": "on"
                    }
                ]
            },
            {
                "featureType": "transit",
                "elementType": "geometry",
                "stylers": [{
                        "hue": "#ff2f00"
                    },
                    {
                        "saturation": 74
                    },
                    {
                        "lightness": -51
                    },
                    {
                        "visibility": "simplified"
                    }
                ]
            },
            {
                "featureType": "water",
                "elementType": "geometry",
                "stylers": [{
                        "hue": "#165c64"
                    },
                    {
                        "saturation": 34
                    },
                    {
                        "lightness": -69
                    },
                    {
                        "visibility": "on"
                    }
                ]
            }
        ]
    };
    map = new google.maps.Map(document.getElementById('map-canvas'), opts);

    // Create map click event
    //    google.maps.event.addListener(map, 'click', function(event) {
    //        // Add destination (max 9)
    //        if (nodes.length >= 9) {
    //            alert('Max destinations added');
    //            return;
}

// If there are directions being shown, clear them
//        clearDirections();

// Add a node to map
//        marker = new google.maps.Marker({position: event.latLng, map: map});
//        markers.push(marker);
// Store node's lat and lng
//        nodes.push(event.latLng);

// Update destination count
//        $('#destinations-count').html(nodes.length);
//    });




//}

// Get all durations depending on travel type
function getDurations(callback) {
    var service = new google.maps.DistanceMatrixService();
    service.getDistanceMatrix({
        origins: nodes,
        destinations: nodes,
        travelMode: google.maps.TravelMode[$('#travel-type').val()],
        avoidHighways: parseInt($('#avoid-highways').val()) > 0 ? true : false,
        avoidTolls: false,
    }, function(distanceData) {
        // Create duration data array
        var nodeDistanceData;
        for (originNodeIndex in distanceData.rows) {
            nodeDistanceData = distanceData.rows[originNodeIndex].elements;

            durations[originNodeIndex] = [];
            for (destinationNodeIndex in nodeDistanceData) {
                if (durations[originNodeIndex][destinationNodeIndex] = nodeDistanceData[destinationNodeIndex].duration == undefined) {


                    alert('Error: couldn\'t get a trip duration from API');
                    return;

                }
                durations[originNodeIndex][destinationNodeIndex] = nodeDistanceData[destinationNodeIndex].duration.value;

            }
        }

        if (callback != undefined) {
            callback();
        }
    });
}

// Removes markers and temporary paths
function clearMapMarkers() {
    for (index in markers) {
        markers[index].setMap(null);
    }

    prevNodes = nodes;
    nodes = [];

    if (polylinePath != undefined) {
        polylinePath.setMap(null);
    }

    markers = [];

    $('#ga-buttons').show();
}
// Removes map directions
function clearDirections() {
    // If there are directions being shown, clear them
    if (directionsDisplay != null) {
        directionsDisplay.setMap(null);
        directionsDisplay = null;
    }
}
// Completely clears map
function clearMap() {
    clearMapMarkers();
    clearDirections();
    removeElement();

    $('#destinations-count').html('0');
    location.reload();
}

// Initial Google Maps
google.maps.event.addDomListener(window, 'load', initializeMap);

// Create listeners
$(document).ready(function() {
    $('#clear-map').click(clearMap);

    // Start GA
    $('#find-route').click(function() {

        ad_show();

        if (nodes.length < 2) {
            if (prevNodes.length >= 2) {
                nodes = prevNodes;
            } else {
                alert('Click on the map to select destination points');
                return;
            }
        }

        if (directionsDisplay != null) {
            directionsDisplay.setMap(null);
            directionsDisplay = null;
        }

        $('#ga-buttons').hide();

        // Get route durations
        getDurations(function() {
            $('.ga-info').show();

            // Get config and create initial GA population
            ga.getConfig();
            var pop = new ga.population();
            pop.initialize(nodes.length);
            var route = pop.getFittest().chromosome;

            ga.evolvePopulation(pop, function(update) {
                $('#generations-passed').html(update.generation);
                $('#best-time').html((update.population.getFittest().getDistance() / 60).toFixed(2) + ' Mins');

                // Get route coordinates
                var route = update.population.getFittest().chromosome;
                var routeCoordinates = [];
                for (index in route) {
                    routeCoordinates[index] = nodes[route[index]];
                }
                routeCoordinates[route.length] = nodes[route[0]];

                // Display temp. route
                if (polylinePath != undefined) {
                    polylinePath.setMap(null);
                }
                polylinePath = new google.maps.Polyline({
                    path: routeCoordinates,
                    strokeColor: "#0066ff",
                    strokeOpacity: 0.75,
                    strokeWeight: 2,
                });
                polylinePath.setMap(map);
            }, function(result) {
                // Get route
                route = result.population.getFittest().chromosome;

                console.log(route)



                for (i = 0; i < 40; i++) { //rotate order until start/end is at the beginning

                    if (route[0] > 0) {
                        route.push(route.shift());

                    }
                    console.log(route)


                    if (route[0] === 0) {
                        break;
                    }

                }


                var names_new = [];

                for (i = 0; i < route.length; i++) {
                    names_new.push(names[route[i]]); //Set venue name list to match order of trip

                }




                // Add route to map
                directionsService = new google.maps.DirectionsService();
                directionsDisplay = new google.maps.DirectionsRenderer();
                directionsDisplay.setMap(map);
                directionsDisplay.setPanel(document.getElementById('directionspanel'));
                var waypts = [];
                for (var i = 1; i < route.length; i++) {
                    waypts.push({
                        location: nodes[route[i]],
                        stopover: true,

                    });
                }

                // Add final route to map
                var request = {
                    origin: nodes[route[0]],
                    destination: nodes[route[0]], //Could change this to end up in a different location
                    waypoints: waypts,
                    travelMode: google.maps.TravelMode[$('#travel-type').val()],
                    avoidHighways: parseInt($('#avoid-highways').val()) > 0 ? true : false,
                    avoidTolls: false
                };
                directionsService.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK) {
                        directionsDisplay.setDirections(response);
                        changetext(names_new);



                        // Adding custom pin
                        //marker = new google.maps.Marker({
                        //    map: map,
                        //    // draggable:true,
                        //    // animation: google.maps.Animation.DROP,
                        //    position: new google.maps.LatLng(40.584133, -105.077102),
                        //    icon: 'http://www.nextprocess.com/wp-content/uploads/2014/04/Google-Pin-Image.png' // null = default icon
                        //});




                    }
                    clearMapMarkers();
                    document.getElementById("venue_options").style.display = "none"; //remove venue list after running
                    document.getElementById("options_table").style.display = "none"; //remove table after running
                });
            });
        });
    });
});

// GA code
var ga = {
    // Default config
    "crossoverRate": 0.5,
    "mutationRate": 0.1,
    "populationSize": 50,
    "tournamentSize": 5,
    "elitism": true,
    "maxGenerations": 5,

    "tickerSpeed": 60,

    // Loads config from HTML inputs
    "getConfig": function() {
        ga.crossoverRate = parseFloat($('#crossover-rate').val());
        ga.mutationRate = parseFloat($('#mutation-rate').val());
        ga.populationSize = parseInt($('#population-size').val()) || 50;
        ga.elitism = parseInt($('#elitism').val()) || false;
        ga.maxGenerations = parseInt($('#maxGenerations').val()) || 5;
    },

    // Evolves given population
    "evolvePopulation": function(population, generationCallBack, completeCallBack) {
        // Start evolution
        var generation = 1;
        var evolveInterval = setInterval(function() {
            if (generationCallBack != undefined) {
                generationCallBack({
                    population: population,
                    generation: generation,
                });
            }

            // Evolve population
            population = population.crossover();
            population.mutate();
            generation++;

            // If max generations passed
            if (generation > ga.maxGenerations) {
                // Stop looping
                clearInterval(evolveInterval);

                if (completeCallBack != undefined) {
                    completeCallBack({
                        population: population,
                        generation: generation,
                    });
                }
            }
        }, ga.tickerSpeed);
    },

    // Population class
    "population": function() {
        // Holds individuals of population
        this.individuals = [];

        // Initial population of random individuals with given chromosome length
        this.initialize = function(chromosomeLength) {
            this.individuals = [];

            for (var i = 0; i < ga.populationSize; i++) {
                var newIndividual = new ga.individual(chromosomeLength);
                newIndividual.initialize();
                this.individuals.push(newIndividual);
            }
        };

        // Mutates current population
        this.mutate = function() {
            var fittestIndex = this.getFittestIndex();

            for (index in this.individuals) {
                // Don't mutate if this is the elite individual and elitism is enabled 
                if (ga.elitism != true || index != fittestIndex) {
                    this.individuals[index].mutate();
                }
            }
        };

        // Applies crossover to current population and returns population of offspring
        this.crossover = function() {
            // Create offspring population
            var newPopulation = new ga.population();

            // Find fittest individual
            var fittestIndex = this.getFittestIndex();

            for (index in this.individuals) {
                // Add unchanged into next generation if this is the elite individual and elitism is enabled
                if (ga.elitism == true && index == fittestIndex) {
                    // Replicate individual
                    var eliteIndividual = new ga.individual(this.individuals[index].chromosomeLength);
                    eliteIndividual.setChromosome(this.individuals[index].chromosome.slice());
                    newPopulation.addIndividual(eliteIndividual);
                } else {
                    // Select mate
                    var parent = this.tournamentSelection();
                    // Apply crossover
                    this.individuals[index].crossover(parent, newPopulation);
                }
            }

            return newPopulation;
        };

        // Adds an individual to current population
        this.addIndividual = function(individual) {
            this.individuals.push(individual);
        };

        // Selects an individual with tournament selection
        this.tournamentSelection = function() {
            // Randomly order population
            for (var i = 0; i < this.individuals.length; i++) {
                var randomIndex = Math.floor(Math.random() * this.individuals.length);
                var tempIndividual = this.individuals[randomIndex];
                this.individuals[randomIndex] = this.individuals[i];
                this.individuals[i] = tempIndividual;
            }

            // Create tournament population and add individuals
            var tournamentPopulation = new ga.population();
            for (var i = 0; i < ga.tournamentSize; i++) {
                tournamentPopulation.addIndividual(this.individuals[i]);
            }

            return tournamentPopulation.getFittest();
        };

        // Return the fittest individual's population index
        this.getFittestIndex = function() {
            var fittestIndex = 0;

            // Loop over population looking for fittest
            for (var i = 1; i < this.individuals.length; i++) {
                if (this.individuals[i].calcFitness() > this.individuals[fittestIndex].calcFitness()) {
                    fittestIndex = i;
                }
            }

            return fittestIndex;
        };

        // Return fittest individual
        this.getFittest = function() {
            return this.individuals[this.getFittestIndex()];
        };
    },

    // Individual class
    "individual": function(chromosomeLength) {
        this.chromosomeLength = chromosomeLength;
        this.fitness = null;
        this.chromosome = [];

        // Initialize random individual
        this.initialize = function() {
            this.chromosome = [];

            // Generate random chromosome
            for (var i = 0; i < this.chromosomeLength; i++) {
                this.chromosome.push(i);
            }
            for (var i = 0; i < this.chromosomeLength; i++) {
                var randomIndex = Math.floor(Math.random() * this.chromosomeLength);
                var tempNode = this.chromosome[randomIndex];
                this.chromosome[randomIndex] = this.chromosome[i];
                this.chromosome[i] = tempNode;
            }
        };

        // Set individual's chromosome
        this.setChromosome = function(chromosome) {
            this.chromosome = chromosome;
        };

        // Mutate individual
        this.mutate = function() {
            this.fitness = null;

            // Loop over chromosome making random changes
            for (index in this.chromosome) {
                if (ga.mutationRate > Math.random()) {
                    var randomIndex = Math.floor(Math.random() * this.chromosomeLength);
                    var tempNode = this.chromosome[randomIndex];
                    this.chromosome[randomIndex] = this.chromosome[index];
                    this.chromosome[index] = tempNode;
                }
            }
        };

        // Returns individuals route distance
        this.getDistance = function() {
            var totalDistance = 0;

            for (index in this.chromosome) {
                var startNode = this.chromosome[index];
                var endNode = this.chromosome[0];
                if ((parseInt(index) + 1) < this.chromosome.length) {
                    endNode = this.chromosome[(parseInt(index) + 1)];
                }

                totalDistance += durations[startNode][endNode];
            }

            totalDistance += durations[startNode][endNode];

            return totalDistance;
        };

        // Calculates individuals fitness value
        this.calcFitness = function() {
            if (this.fitness != null) {
                return this.fitness;
            }

            var totalDistance = this.getDistance();

            this.fitness = 1 / totalDistance;
            return this.fitness;
        };

        // Applies crossover to current individual and mate, then adds it's offspring to given population
        this.crossover = function(individual, offspringPopulation) {
            var offspringChromosome = [];

            // Add a random amount of this individual's genetic information to offspring
            var startPos = Math.floor(this.chromosome.length * Math.random());
            var endPos = Math.floor(this.chromosome.length * Math.random());

            var i = startPos;
            while (i != endPos) {
                offspringChromosome[i] = individual.chromosome[i];
                i++

                if (i >= this.chromosome.length) {
                    i = 0;
                }
            }

            // Add any remaining genetic information from individual's mate
            for (parentIndex in individual.chromosome) {
                var node = individual.chromosome[parentIndex];

                var nodeFound = false;
                for (offspringIndex in offspringChromosome) {
                    if (offspringChromosome[offspringIndex] == node) {
                        nodeFound = true;
                        break;
                    }
                }

                if (nodeFound == false) {
                    for (var offspringIndex = 0; offspringIndex < individual.chromosome.length; offspringIndex++) {
                        if (offspringChromosome[offspringIndex] == undefined) {
                            offspringChromosome[offspringIndex] = node;
                            break;
                        }
                    }
                }
            }

            // Add chromosome to offspring and add offspring to population
            var offspring = new ga.individual(this.chromosomeLength);
            offspring.setChromosome(offspringChromosome);
            offspringPopulation.addIndividual(offspring);
        };
    },
};


//Creating start and stop location. After created you can choose venues
function geocodeAddress(geocoder, resultsMap) {
    var address = document.getElementById('address').value;
    geocoder.geocode({
        'address': address
    }, function(results, status) {
        if (status === 'OK') {
            resultsMap.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
                map: resultsMap,
                position: results[0].geometry.location
            });

            markers.push(marker);


            // Store node's lat and lng
            nodes.push(marker.position);

            document.getElementById("venue_options").style.display = "block";
            document.getElementById("button_grp").style.display = "block";

            document.getElementById("add_address").style.display = "none";

            var x_destinations = nodes.length.toString()

            document.getElementById("destinations-count").innerHTML = x_destinations;
            nameslist("Start/End")


        } else {
            alert('Geocode was not successful for the following reason: ' + status);
        }
    });
}



// Remove venue after being selected. Preventing same selector being chosen twice
function removeselecter() {
    var x = document.getElementById("venue_options");
    x.remove(x.selectedIndex);
}


// Accordion
var acc = document.getElementsByClassName("accordion");
var i;

for (i = 0; i < acc.length; i++) {
    acc[i].addEventListener("click", function() {
        /* Toggle between adding and removing the "active" class,
        to highlight the button that controls the panel */
        this.classList.toggle("active");

        /* Toggle between hiding and showing the active panel */
        var panel = this.nextElementSibling;
        if (panel.style.display === "block") {
            panel.style.display = "none";
        } else {
            panel.style.display = "block";
        }
    });
}

</script>
<!-- End of routing script -->



<!--Trigger interstitial add after 30 seconds -->
<script type="text/javascript">
// setTimeout("CallButton()",30000)
function CallButton()
{
     admob.interstitial.show()    
}
</script>

<script type="text/javascript">
function adcount() {
   if (localStorage.getItem("tracking") === null) {
    localStorage.setItem("tracking", "1");
   }

  
  var tracking_current = localStorage.getItem("tracking");
  var tracking_current = tracking_current+parseInt("1");

  localStorage.setItem("tracking", tracking_current);

  if(tracking_current.length>=4){
    CallButton()
    localStorage.setItem("tracking", "1");
  }
  
}
</script>
</head>
<body onload="navfunction()">

<nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">
             <!-- <img src="logo.PNG" alt="Palisade Valley Wine Finder"> -->
             <h3 style="margin-top: 10px; font-weight: bolder; color: white; padding-left: 10px">Palisade Wine Finder</h3>
          </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <li><a href="#" onclick="showwineeries();adcount()" data-target=".navbar-collapse">Wineries</a></li>
            <li><a href="#" onclick="route();adcount()" data-target=".navbar-collapse">Plan Route</a></li>
            <!-- <li><a href="map.html"  data-target=".navbar-collapse">Map View</a></li> -->
            <li><a href="iso.html"  data-target=".navbar-collapse">Find Nearby Locations</a></li>
            <li><a href="#" onclick="tour();adcount()" data-target=".navbar-collapse">Tour Companies & Bike Rentals</a></li>
            <li><a href="tasting.html" data-target=".navbar-collapse">Tasting Sheet</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

<div class="main">


<!-- Start of winery list -->
<section class="major_section" id="winelist" style="display: block">

<input placeholder="Search by Name or City" id="box" type="text" />

<div id="venues"></div>


</section>
<!-- End of winery list -->

<!-- Start of map section -->
<section class="major_section" id="route" style="display: none">
    <div class="panel-group" id="raccordion" role="tablist" aria-multiselectable="true">
    <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="rheading1">
            <h4 class="panel-title">
                <a class="collapsed" data-toggle="collapse" data-parent="#raccordion" href="#rcollapse1" aria-expanded="false" aria-controls="rcollapse1" style="color:white">
                    &#x25BC; Instructions &#x25BC;
                </a>
            </h4>
        </div>
        <div id="rcollapse1" class="panel-collapse collapse" role="tabpanel" aria-labelledby="rheading1">
            <div class="panel-body">
                    <p>You can use the map below to help plan the most efficient way to travel between locations in the Palisade/Grand Junction area. You will start by specifying where you want to start your trip from. This will also be your ending location. Once you select a starting and ending location you can choose up to eight additional stops to make using the drop down menu. You can also choose if you are planning on traveling by car or bicycle and if you'd like to try and avoid highways. Once you've chosen all your locations you can click START and we run an optimzation tool to try and find you the most efficient order to travel between locations.</p>
            </div>
        </div>
    </div>
</div>

    <div id="map-canvas" style="width:100vw; height:50vh;"></div>

<br>

<div id="add_address">
    <input id="address" type="textbox" value="Palisade, CO" class="form-control">
    <input id="submit" type="button" value="Add Starting/Ending Address" class="form-control">
</div>
<div id="button_grp" style="display: none;">
    <button id="find-route" class="form-control">Start</button>
    <br>
    <button id="clear-map" class="form-control">Clear</button>
    <br>
</div>
<span>Permutations Tried: </span><span id="generations-passed"></span>
<div id="directionspanel"></div>

<!--Search panel for venues -->
<select name="report_type" id="venue_options" onchange="addmarker(this.value);nameslist(this[selectedIndex].id);removeselecter()" style="display: none;" class="form-control">
    <option value="38.82634,-107.60381" id="Alfred Eames Cellars">Alfred Eames Cellars</option>
    <option value="39.07861,-108.41027" id="Avant Vineyards">Avant Vineyards</option>
    <option value="38.88589,-107.58253" id="Black Bridge Winery">Black Bridge Winery</option>
    <option value="39.07221,-108.40469" id="Carlson Vineyards">Carlson Vineyards</option>
    <option value="39.07505,-108.39373" id="Colorado Cellars Winery">Colorado Cellars Winery</option>
    <option value="39.108054,-108.355876" id="Colterris Winery">Colterris Winery</option>
    <option value="38.60797,-108.03621" id="Cottonwood Cellars">Cottonwood Cellars</option>
    <option value="39.105627,-108.355456" id="DeBeque Canyon Winery">DeBeque Canyon Winery</option>
    <option value="39.04227,-108.45359" id="Desert Sun Vineyards">Desert Sun Vineyards</option>
    <option value="39.107404,-108.389369" id="Garfield Estates Vineyard and Winery">Garfield Estates Vineyard and Winery</option>
    <option value="39.117231,-108.362088" id="Grande River Vineyards">Grande River Vineyards</option>
    <option value="39.091901,-108.430842" id="Graystone Winery">Graystone Winery</option>
    <option value="39.09035,-108.3667" id="Gubbini Winery">Gubbini Winery</option>
    <option value="39.045728,-108.447431" id="Hermosa Vineyards">Hermosa Vineyards</option>
    <option value="39.104194,-108.389553" id="Maison La Belle Vie Winery">Maison La Belle Vie Winery</option>
    <option value="39.105832,-108.365821" id="Meadery of the Rockies">Meadery of the Rockies</option>
    <option value="39.046375,-108.436188" id="Mesa Park Vineyards">Mesa Park Vineyards</option>
    <option value="38.60738,-108.00163" id="Mountain View Winery">Mountain View Winery</option>
    <option value="39.106845,-108.365892" id="Plum Creek Winery">Plum Creek Winery</option>
    <option value="39.03675,-108.4749" id="Ptarmigan Vineyards">Ptarmigan Vineyards</option>
    <option value="39.10468,-108.38576" id="Red Fox Cellars">Red Fox Cellars</option>
    <option value="39.0846623,-108.3857671" id="Restoration Vineyards">Restoration Vineyards</option>
    <option value="39.06603,-108.56488" id="Shiras Winery">Shiras Winery</option>
    <option value="39.116621,-108.36067" id="St Kathryn Cellars">St Kathryn Cellars</option>
    <option value="38.899693,-107.577303" id="Stone Cottage Cellars">Stone Cottage Cellars</option>
    <option value="39.097046,-108.349879" id="Talbott's Mountain Gold LLLP">Talbott's Mountain Gold LLLP</option>
    <option value="39.116621,-108.36067" id="Talon Wines">Talon Wines</option>
    <option value="39.04591,-108.44237" id="The Peachfork">The Peachfork</option>
    <option value="39.090821,-108.662153" id="Two Rivers Winery">Two Rivers Winery</option>
    <option value="39.111978,-108.355815" id="Varaison Vineyards and Winery, LLC">Varaison Vineyards and Winery, LLC</option>
    <option value="39.03685,-108.45828" id="Whitewater Hill Vineyards">Whitewater Hill Vineyards</option>
    <option value="39.118056,-108.364689" id="Wine Country Inn">Wine Country Inn</option>

</select>

<script type="text/javascript">
    var names = [];

    function nameslist(current_name) {
        names.push(current_name);
        console.log(names);
    }

    function addmarker(latlng) {

        var array = latlng.split(",");
        console.log(array)

        var marker = new google.maps.Marker({
            // The below line is equivalent to writing:
            // position: new google.maps.LatLng(-34.397, 150.644)
            position: {
                lat: parseFloat(array[0]),
                lng: parseFloat(array[1])
            },

            map: map,
            title: "Drag me!",

        });

        markers.push(marker);

        // Store node's lat and lng
        nodes.push(marker.position);

        // Update Node Count
        var x_destinations = nodes.length.toString()
        document.getElementById("destinations-count").innerHTML = x_destinations;

        // Hide venues if 9 nodes have already been selected.
        if (nodes.length >= 9) {
            document.getElementById("venue_options").style.display = "none";
            document.getElementById("venue_options_max").style.display = "block";
        }

        // Fit to screen to all markers
        var bounds = new google.maps.LatLngBounds();

        // Create an array of all markers
        for (var i = 0; i < markers.length; i++) {
            bounds.extend(markers[i].getPosition());
        }

        // Do actual fitting
        map.fitBounds(bounds);

        // set a minimum zoom 
        // if you got only 1 marker or all markers are on the same address map will be zoomed too much.
        if (map.getZoom() > 15) {
            map.setZoom(15);
        }

    }
</script>

<div class="hr vpad"></div>
<div>
    <table id="options_table">
        <tr>
            <td>Destinations Count: (maximum of nine)</td>
            <td id="destinations-count">0</td>
        </tr>
        <tr>
            <td colspan="2"><b>Route Options</b></td>
        </tr>
        <tr>
            <td>Travel Mode: </td>
            <td>
                <select id="travel-type">
                    <option value="DRIVING" class="form-control">Car</option>
                    <option value="BICYCLING" class="form-control">Bicycle</option>
                    <!-- <option value="WALKING">Walking</option> -->
                </select>
            </td>
        </tr>
        <tr>
            <td>Avoid Highways: </td>
            <td>
                <select id="avoid-highways">
                    <option value="1">Yes</option>
                    <option value="0" selected="selected">Not Necessary</option>
                </select>
            </td>
        </tr>
        <tr style="display: none">
            <td>Population Size: </td>
            <td>
                <select id="population-size">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="50" selected="selected">50</option>
                    <option value="100">100</option>
                    <option value="200">200</option>
                </select>
            </td>
        </tr>
        <tr style="display: none">
            <td>Mutation Rate: </td>
            <td>
                <select id="mutation-rate">
                    <option value="0.00">0.00</option>
                    <option value="0.05">0.01</option>
                    <option value="0.05">0.05</option>
                    <option value="0.1" selected="selected">0.1</option>
                    <option value="0.2">0.2</option>
                    <option value="0.4">0.4</option>
                    <option value="0.7">0.7</option>
                    <option value="1">1.0</option>
                </select>
            </td>
        </tr>
        <tr style="display: none">
            <td>Crossover Rate: </td>
            <td>
                <select id="crossover-rate">
                    <option value="0.0">0.0</option>
                    <option value="0.1">0.1</option>
                    <option value="0.2">0.2</option>
                    <option value="0.3">0.3</option>
                    <option value="0.4">0.4</option>
                    <option value="0.5" selected="selected">0.5</option>
                    <option value="0.6">0.6</option>
                    <option value="0.7">0.7</option>
                    <option value="0.8">0.8</option>
                    <option value="0.9">0.9</option>
                    <option value="1">1.0</option>
                </select>
            </td>
        </tr>
        <tr style="display: none">
            <td>Elitism: </td>
            <td>
                <select id="elitism">
                    <option value="1" selected="selected">Enabled</option>
                    <option value="0">Disabled</option>
                </select>
            </td>
        </tr>
        <tr style="display: none">
            <td>Max Generations: </td>
            <td>
                <select id="generations">
                    <option value="3">3</option>
                    <option value="50" selected="selected">5</option>
                    <option value="10">10</option>
                </select>
            </td>
        </tr>
        <tr style="display: none">
            <td colspan="2"><b>Debug Info</b></td>
        </tr>

        <tr class="ga-info" style="display:none;">
            <td style="display:none;">Generations: </td>
            <td style="display:none;" id="generations-passed">0</td>
        </tr>
        <tr class="ga-info" style="display:none;">
            <td style="display:none;">Best Time: </td>
            <td id="best-time" style="display:none;">?</td>
        </tr>
        <tr id="ga-buttons" style="display: none">
            <td colspan="2"></td>
        </tr>
    </table>
    <p id="venue_options_max" style="display: none;">You have added the maximum number of locations possible</p>
</div>
</div>

<!-- Change Text in Directions -->
<script>
    function changetext(names_incoming) {
        setTimeout(function() {
            //do what you need here

            var y = names_incoming;

            x = document.getElementsByClassName("adp-text"); // Find the elements
            for (var i = 0; i < x.length; i++) {

                x[i].innerText = y[i]; // Change the content

                if (y[i] == undefined) {
                    x[i].innerText = y[0];

                }

            }
        }, 500);
    }
</script>

<!-- Clear Directions -->
<script type="text/javascript">
    function removeElement() {
        // Removes an element from the document
        document.getElementById('directionspanel').innerHTML = "";
    }
</script>
</section>
<!-- End of map section -->

<!-- Start of tour company section -->
<section class="major_section" id="tour" style="display: none">
  <h2>Local Tour Companies</h2>
  <h4>Wine tasting is all about having fun but it is never alright to have too much fun and get behind the wheel. There are several different tour company options in the Palisade/Grand Junction area if you want to skip being responsible for a car.</h4>
  <h5>Quick note - we are in no way associated or affiliated with these groups. We just want to make sure everyone gets home safe at the end of the day.</h5>
  <div>
    <a href="https://aplimo.com/services/wine-tours/">
    <img src="https://aplimo.com/wp-content/uploads/2019/02/ap-logo-main.png" alt="Absolute Prestige Limo & Ranch" width="100vw"><h4>Absolute Prestige Limo & Ranch</h4></a><br>

    <a href="https://www.pali-tours.com/">
    <img src="https://static.wixstatic.com/media/b84eae_d8d722cde43948159ac9da900a081b21~mv2_d_4147_3779_s_4_2.png/v1/fill/w_294,h_268,al_c,q_85,usm_0.66_1.00_0.01/PALI-TOURS%20LOGO%20sun%20grass%20and%20garfield%20W.webp" alt="Pali Tours" width="100vw"><h4>Pali Tours</h4></a><br>

    <a href="https://palisadepedicab.com/">
    <img src="img/IMG_1131.jpg" alt="Palisade Pedicab" width="100vw"><h4>Palisade Pedicab</h4></a><br>

        <a href="http://grandjunction-tours.com//">
    <img src="http://grandjunction-tours.com/wp-content/uploads/2015/11/gjtoursnew_color.png" alt="Grand Junction Tours" width="100vw"><h4>Grand Junction Tours</h4></a><br>

  <h2>How About Renting a Bike Instead?</h2>
  <h5>Have no interest in being on a shuttle bus? How about renting a bike and getting your heart pumping as you go from spot to spot?</h5>


        <a href="https://rapidcreekcycles.com/">
    <img src="https://fh-sites.imgix.net/sites/2278/2019/02/08191229/logo-300x62.png?auto=compress%2Cformat&h=120&fit=max" alt="Rapid Creek Cycles" width="100vw"><h4>Rapid Creek Cycles</h4></a><br>

        <a href="https://browncycles.com/bc/rental-bikes/">
    <img src="img/BANNER-copy.jpg" alt="Brown Cycles" width="100vw"><h4>Brown Cycles</h4></a><br>
  </div>
</section>
<!-- End of tour company section -->





</div>



<script>

  document.getElementById("box").oninput=function(){
  var matcher = new RegExp(document.getElementById("box").value, "gi");
  for (var i=0;i<document.getElementsByClassName("connect-cat").length;i++) {
    if (matcher.test(document.getElementsByClassName("winery_title")[i].innerHTML)||matcher.test(document.getElementsByClassName("city")[i].innerHTML)) {
      document.getElementsByClassName("connect-cat")[i].style.display="inline-block";
    } else {
      document.getElementsByClassName("connect-cat")[i].style.display="none";
    }
      
  }
}
  
</script>


  <script src="js/mapresources.js"></script>

  <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
  <script src="js/index.js"></script>

  <script type="text/javascript" src="cordova.js"></script>
  <script src="js/admob.js"></script>
  <script type="text/javascript" src="phonegap.js"></script>

  </body>
</html>
